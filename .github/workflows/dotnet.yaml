# Название вашего процесса автоматизации. Оно будет отображаться в GitHub.
name: .NET Build and Test

# Триггеры: когда запускать этот процесс.
on:
  # Запускать при каждом push в любую ветку, кроме main.
  push:
    branches-ignore:
      - 'main'
  
  # Также запускать для Pull Request'ов, нацеленных на ветку main.
  pull_request:
    branches:
      - 'main'

# Задачи: что именно нужно сделать.
jobs:
  build-and-test:
    # На какой операционной системе запускать. ubuntu-latest - быстрый и бесплатный.
    runs-on: ubuntu-latest

    # Шаги: последовательность команд, которые нужно выполнить.
    steps:
    # 1. Клонирование вашего репозитория на виртуальную машину
    - name: Checkout code
      uses: actions/checkout@v4

    # 2. Установка нужной версии .NET SDK
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        # Укажите здесь вашу версию .NET. Например, '8.0.x' или '7.0.x'
        dotnet-version: '8.0.x'

    # 3. Восстановление зависимостей (NuGet пакетов) для всего решения
    - name: Restore dependencies
      run: dotnet restore

    # 4. Сборка всего решения в режиме Release.
    - name: Build
      run: dotnet build --no-restore --configuration Release

    # 5. Запуск всех тестов в решении.
    #    Используем ту же конфигурацию, что и при сборке.
    - name: Test
      run: dotnet test --no-build --configuration Release --verbosity normal